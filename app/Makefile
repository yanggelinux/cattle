# ----------------------------------------
# Go Cross-Platform Build Makefile
# ----------------------------------------

# è¾“å‡ºç›®å½•å’Œæ–‡ä»¶
BIN_DIR := cmd/bin
APP_NAME := cattle
SRC_FILE := cmd/cattle/cattle.go

# é€šç”¨ç¼–è¯‘å‚æ•°ï¼ˆåŽ»ç¬¦å·è¡¨ä¸Žè°ƒè¯•ä¿¡æ¯ï¼‰
LDFLAGS := -ldflags="-s -w"

# è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿ
ifeq ($(OS),Windows_NT)
	RM := del /Q
	MKDIR := if not exist $(BIN_DIR) mkdir $(BIN_DIR)
	EXT := .exe
else
	RM := rm -rf
	MKDIR := mkdir -p $(BIN_DIR)
	EXT :=
endif

# é»˜è®¤ç›®æ ‡
.DEFAULT_GOAL := help

# ----------------------------------------
# ðŸ§± Build Commands
# ----------------------------------------

## build.unix: æž„å»º Linux ç‰ˆæœ¬
build.unix:
	@echo "ðŸ”§ Building for Linux amd64..."
	@$(MKDIR)
	@CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build $(LDFLAGS) -o $(BIN_DIR)/$(APP_NAME)$(EXT) $(SRC_FILE)
	@echo "âœ… Build done -> $(BIN_DIR)/$(APP_NAME)$(EXT)"

## build.windows: æž„å»º Windows ç‰ˆæœ¬
build.windows:
	@echo "ðŸ”§ Building for Windows amd64..."
	@$(MKDIR)
	@CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build $(LDFLAGS) -o $(BIN_DIR)/$(APP_NAME).exe $(SRC_FILE)
	@echo "âœ… Build done -> $(BIN_DIR)/$(APP_NAME).exe"

## build.local: æ ¹æ®å½“å‰ç³»ç»Ÿæž„å»º
build.local:
	@echo "ðŸ”§ Building for local system..."
	@$(MKDIR)
	@go build $(LDFLAGS) -o $(BIN_DIR)/$(APP_NAME)$(EXT) $(SRC_FILE)
	@echo "âœ… Local build done -> $(BIN_DIR)/$(APP_NAME)$(EXT)"

# ----------------------------------------
# ðŸ§¹ Clean Command
# ----------------------------------------

## clean: æ¸…ç†æž„å»ºäº§ç‰©
clean:
	@echo "ðŸ§¹ Cleaning build files..."
	@go clean
	@$(RM) $(BIN_DIR)/$(APP_NAME)*$(EXT) 2>nul || true
	@echo "âœ… Clean done."

# ----------------------------------------
# ðŸ“˜ Help
# ----------------------------------------

help:
	@echo ""
	@echo "ðŸ“¦ Available Commands:"
	@echo "  make build.unix     - Build Linux amd64 binary"
	@echo "  make build.windows  - Build Windows amd64 binary"
	@echo "  make build.local    - Build binary for current OS"
	@echo "  make clean          - Clean build outputs"
	@echo "  make help           - Show this help"
	@echo ""
